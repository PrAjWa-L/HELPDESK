{% extends "base.html" %}

{% block page_title %}{{ action }} Task{% endblock %}

{% block topbar_actions %}
  <a href="/tasks" class="btn btn-outline">← Back to Tasks</a>
{% endblock %}

{% block content %}

<div class="page-header">
  <div>
    <div class="page-title">{{ action }} Task</div>
    <div class="page-subtitle">
      {% if action == "Create" %}Set up a new maintenance task with a deadline and notification email.
      {% else %}Update task details. Changing the deadline will reset and reschedule the email alert.{% endif %}
    </div>
  </div>
</div>

<div style="max-width:620px;">
  <div class="card">
    <div class="card-header">
      <div class="card-title">Task Details</div>
    </div>
    <div style="padding:24px;">
      <form method="post">

        <div class="form-group">
          <label class="form-label">Task Title</label>
          <input name="title" class="form-control"
                 placeholder="e.g. Monthly fire extinguisher inspection"
                 value="{{ task.title if task else '' }}" required>
        </div>

        <div class="form-group">
          <label class="form-label">Description <span style="color:var(--muted);font-weight:500;">(optional)</span></label>
          <textarea name="description" class="form-control"
                    placeholder="Any additional notes or instructions">{{ task.description if task else '' }}</textarea>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">Assigned To</label>
            <input name="assigned_to" class="form-control"
                   placeholder="Person or team name"
                   value="{{ task.assigned_to if task else '' }}" required>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select name="status" class="form-select">
              <option value="PENDING"     {% if task and task.status == 'PENDING'     %}selected{% endif %}>Pending</option>
              <option value="IN_PROGRESS" {% if task and task.status == 'IN_PROGRESS' %}selected{% endif %}>In Progress</option>
              <option value="COMPLETED"   {% if task and task.status == 'COMPLETED'   %}selected{% endif %}>Completed</option>
            </select>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">Deadline</label>
            <input type="datetime-local" name="deadline" class="form-control"
                   value="{{ task.deadline | ist_input if task else '' }}" required>
            {% if action == "Edit" %}
            <div style="font-size:11.5px;color:var(--muted);margin-top:5px;">Changing the deadline resets the email alert.</div>
            {% endif %}
          </div>
        </div>

        <div style="padding-top:6px;border-top:1.5px solid var(--border);margin-top:4px;display:flex;justify-content:flex-end;gap:10px;">
          <a href="/tasks" class="btn btn-outline">Cancel</a>
          <button type="submit" class="btn btn-primary">{{ action }} Task →</button>
        </div>

      </form>
    </div>
  </div>
</div>

{% endblock %}