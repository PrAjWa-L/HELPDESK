{% extends "base.html" %}

{% block page_title %}Department View{% endblock %}

{% block topbar_actions %}
  <a href="/report" class="btn btn-outline">â†“ Download Report</a>
{% endblock %}

{% block content %}

<div class="page-header">
  <div>
    <div class="page-title">{{ current_user.department }} Department</div>
    <div class="page-subtitle">All tickets assigned to your department, including unassigned (Other) tickets.</div>
  </div>
</div>

<div class="card">
  {% if tickets %}
  <div style="overflow-x:auto;">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ticket ID</th>
          <th>Title</th>
          <th>Priority</th>
          <th>Status</th>
          <th>SLA Due</th>
          <th>Raised By</th>
        </tr>
      </thead>
      <tbody>
        {% for ticket in tickets %}
        <tr>
          <td>
            <a href="{{ url_for('tickets.ticket_detail', ticket_id=ticket.id) }}" class="table-link">
              #{{ '%04d' % ticket.id }}
            </a>
          </td>
          <td style="font-weight:600;color:var(--text);">{{ ticket.title }}</td>
          <td>
            {% if ticket.priority == "CRITICAL" %}<span class="pill pill-critical">Critical</span>
            {% elif ticket.priority == "ESSENTIAL" %}<span class="pill pill-essential">Essential</span>
            {% else %}<span class="pill pill-desirable">Desirable</span>{% endif %}
          </td>
          <td>
            {% if ticket.status == "OPEN" %}<span class="pill pill-open">Open</span>
            {% elif ticket.status == "IN_PROGRESS" %}<span class="pill pill-progress">In Progress</span>
            {% elif ticket.status == "RESOLVED" %}<span class="pill pill-resolved">Resolved</span>
            {% else %}<span class="pill pill-closed">Closed</span>{% endif %}
          </td>
          <td>
            <span style="font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);">
              {{ ticket.sla_due_at.strftime('%d %b %Y') if ticket.sla_due_at else 'â€”' }}
            </span>
          </td>
          <td style="font-size:12.5px;color:var(--muted);font-weight:600;">
            {{ ticket.created_by.username }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-icon">ðŸŽ«</div>
    <p>No tickets in this department yet.</p>
  </div>
  {% endif %}
</div>

{% endblock %}
